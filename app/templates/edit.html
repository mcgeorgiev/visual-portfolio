{% extends "base.html" %}
{% block content %}
  <link rel="stylesheet" href="static/stylesheets/tiles.css" type="text/css">
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>



  <script>

  $( function() {


  });
  </script>
    <button id="set-images" type="button">Confirm Images</button>
    <span id="result"></span>
    <div class="thumbnail-grid">
      <div id="sortable" class="grid">
        {% for image in data.images %}
        <div class="cell" id={{ image.id }}>
          <img src="{{ image.thumbnail_path }}" class="responsive-image">
          <div class ="overlay"><div class="text">{{ image.title }}</div></div>
        </div>
        {% endfor %}
      </div>
    </div>

  <script>
  $( document ).ready(function(){


    $("#sortable").sortable({
      placeholder: {
          element: function(currentItem) {
              return $("<div class='cell placeholder'></div>")[0];
          },
          update: function(container, p) {
              return;
          },
      }
    });
    $("#sortable").disableSelection();
    $("#sortable").sortable({ items : '.cell:not(.unsortable)' });


    var imageNum = $(".cell").length;
    var rowLength = 3;
    var remainder = imageNum % rowLength;
    if (remainder !== 0) {
      var emptyCellNum = rowLength - remainder;
      for (var i = 0; i < emptyCellNum; i++) {
        $(".grid").append("<div class='cell unsortable'></div>");
      }
    }


    $('#set-images').click(function() {

      // get the ids and positions in an object
      var positionObject = {};
      $( ".cell" ).each(function(index) {
        // console.log(index + ": " + $(this).attr("id"));
        positionObject[index] = $(this).attr("id");
      });

      // ajax it
      $.ajax({
        url:"/set_positions",
        type: "post",
        dataType: "json",
        data: {postitionData: JSON.stringify(positionObject)},
        success: function(result) {
          console.log(result.response);
          $("#result").text(result.response)
        }
      });
    });
  });
  </script>

{% endblock %}
